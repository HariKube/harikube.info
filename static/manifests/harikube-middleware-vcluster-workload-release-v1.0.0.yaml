apiVersion: v1
kind: Namespace
metadata:
  name: harikube
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: harikube-db-pvc
  namespace: harikube
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 5Gi
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: harikube-middleware
  namespace: harikube
  labels:
    app: harikube
spec:
  replicas: 1
  selector:
    matchLabels:
      app: harikube
  template:
    metadata:
      labels:
        app: harikube
    spec:
      terminationGracePeriodSeconds: 30
      affinity:
        nodeAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
              - matchExpressions:
                - key: kubernetes.io/arch
                  operator: In
                  values:
                    - arm64
                    - amd64
                    - s390x
                    - ppc64le
                - key: kubernetes.io/os
                  operator: In
                  values:
                    - linux
      securityContext:
        runAsNonRoot: true
        runAsUser: 65532
        runAsGroup: 65532
        fsGroup: 65532
        fsGroupChangePolicy: OnRootMismatch
        seccompProfile:
          type: RuntimeDefault
      imagePullSecrets:
      - name: harikube-registry-secret
      containers:
      - name: middleware
        image: registry.harikube.info/harikube/middleware:release-v1.0.0
        imagePullPolicy: IfNotPresent
        env:
        - name: TOPOLOGY_CONFIG
          value: secret://harikube/topology-config
        - name: LICENSE_KEY_FILE
          value: /etc/harikube/license
        - name: ENABLE_TELEMETRY_PUSH
          value: "false"
        args:
        - --log-format=json
        - --slow-sql-threshold=2s
        - --datastore-max-idle-connections=50
        - --datastore-max-open-connections=90
        - --datastore-connection-max-lifetime=5m
        - --datastore-connection-max-idle-lifetime=5m
        - --endpoint=multi://sqlite:///db/main.db?_journal=WAL&cache=shared
        ports:
        - containerPort: 2379
          name: api-port
        - containerPort: 8080
          name: metrics
        volumeMounts:
        - name: license
          mountPath: /etc/harikube
          readOnly: true
        - name: db-storage
          mountPath: /db
        - name: tmp
          mountPath: /tmp
        livenessProbe:
          grpc:
            port: 2379
          initialDelaySeconds: 15
          timeoutSeconds: 5
          periodSeconds: 20
          failureThreshold: 3
        readinessProbe:
          grpc:
            port: 2379
          initialDelaySeconds: 5
          timeoutSeconds: 3
          periodSeconds: 10
          failureThreshold: 3
        securityContext:
          allowPrivilegeEscalation: false
          runAsNonRoot: true
          runAsUser: 65532
          runAsGroup: 65532
          readOnlyRootFilesystem: true
          capabilities:
            drop:
            - ALL
          seccompProfile:
            type: RuntimeDefault
        resources:
          limits:
            memory: 4Gi
          requests:
            cpu: 1000m
            memory: 1Gi
      volumes:
      - name: license
        secret:
          secretName: harikube-license
      - name: db-storage
        persistentVolumeClaim:
          claimName: harikube-db-pvc
      - name: tmp
        emptyDir: {}
---
apiVersion: v1
kind: Service
metadata:
  name: harikube-middleware-svc
  namespace: harikube
spec:
  type: ClusterIP 
  selector:
    app: harikube
  ports:
    - name: http
      protocol: TCP
      port: 2379
      targetPort: api-port
---
apiVersion: v1
kind: Service
metadata:
  name: harikube-middleware-metrics-svc
  namespace: harikube
  labels:
    app: harikube
    app.kubernetes.io/component: metrics 
spec:
  type: ClusterIP 
  selector:
    app: harikube
  ports:
    - name: metrics
      protocol: TCP
      port: 8080
      targetPort: metrics
---
---
# Source: vcluster/templates/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: vc-harikube
  namespace: harikube
  labels:
    app: vcluster
    chart: "vcluster-0.31.0"
    release: "harikube"
    heritage: "Helm"
---
# Source: vcluster/templates/workload-serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: vc-workload-harikube
  namespace: harikube
  labels:
    app: vcluster
    chart: "vcluster-0.31.0"
    release: "harikube"
    heritage: "Helm"
---
# Source: vcluster/templates/config-secret.yaml
apiVersion: v1
kind: Secret
metadata:
  name: "vc-config-harikube"
  namespace: harikube
  labels:
    app: vcluster
    chart: "vcluster-0.31.0"
    release: "harikube"
    heritage: "Helm"
type: Opaque
data:
  config.yaml: "Y29udHJvbFBsYW5lOgogIGFkdmFuY2VkOgogICAgY2xvdWRDb250cm9sbGVyTWFuYWdlcjoKICAgICAgZW5hYmxlZDogdHJ1ZQogICAgZGVmYXVsdEltYWdlUmVnaXN0cnk6ICIiCiAgICBnbG9iYWxNZXRhZGF0YToKICAgICAgYW5ub3RhdGlvbnM6IHt9CiAgICBoZWFkbGVzc1NlcnZpY2U6CiAgICAgIGFubm90YXRpb25zOiB7fQogICAgICBsYWJlbHM6IHt9CiAgICBrb25uZWN0aXZpdHk6CiAgICAgIGFnZW50OgogICAgICAgIGVuYWJsZWQ6IHRydWUKICAgICAgICBleHRyYUFyZ3M6IFtdCiAgICAgICAgZXh0cmFFbnY6IFtdCiAgICAgICAgaW1hZ2U6ICIiCiAgICAgICAgaW1hZ2VQdWxsUG9saWN5OiAiIgogICAgICAgIG5vZGVTZWxlY3Rvcjoge30KICAgICAgICByZXBsaWNhczogMQogICAgICAgIHRvbGVyYXRpb25zOiBbXQogICAgICBzZXJ2ZXI6CiAgICAgICAgZW5hYmxlZDogdHJ1ZQogICAgICAgIGV4dHJhQXJnczogW10KICAgIGt1YmVWaXA6CiAgICAgIGVuYWJsZWQ6IGZhbHNlCiAgICBwb2REaXNydXB0aW9uQnVkZ2V0OgogICAgICBlbmFibGVkOiBmYWxzZQogICAgcmVnaXN0cnk6CiAgICAgIGFub255bW91c1B1bGw6IHRydWUKICAgICAgY29uZmlnOiB7fQogICAgICBlbmFibGVkOiBmYWxzZQogICAgc2VydmljZUFjY291bnQ6CiAgICAgIGFubm90YXRpb25zOiB7fQogICAgICBlbmFibGVkOiB0cnVlCiAgICAgIGltYWdlUHVsbFNlY3JldHM6IFtdCiAgICAgIGxhYmVsczoge30KICAgICAgbmFtZTogIiIKICAgIHZpcnR1YWxTY2hlZHVsZXI6CiAgICAgIGVuYWJsZWQ6IGZhbHNlCiAgICB3b3JrbG9hZFNlcnZpY2VBY2NvdW50OgogICAgICBhbm5vdGF0aW9uczoge30KICAgICAgZW5hYmxlZDogdHJ1ZQogICAgICBpbWFnZVB1bGxTZWNyZXRzOiBbXQogICAgICBsYWJlbHM6IHt9CiAgICAgIG5hbWU6ICIiCiAgYmFja2luZ1N0b3JlOgogICAgZGF0YWJhc2U6CiAgICAgIGVtYmVkZGVkOgogICAgICAgIGVuYWJsZWQ6IGZhbHNlCiAgICAgICAgZXh0cmFBcmdzOiBbXQogICAgICBleHRlcm5hbDoKICAgICAgICBjYUZpbGU6ICIiCiAgICAgICAgY2VydEZpbGU6ICIiCiAgICAgICAgY29ubmVjdG9yOiAiIgogICAgICAgIGRhdGFTb3VyY2U6ICIiCiAgICAgICAgZW5hYmxlZDogZmFsc2UKICAgICAgICBleHRyYUFyZ3M6IFtdCiAgICAgICAgaWRlbnRpdHlQcm92aWRlcjogIiIKICAgICAgICBrZXlGaWxlOiAiIgogICAgZXRjZDoKICAgICAgZGVwbG95OgogICAgICAgIGVuYWJsZWQ6IGZhbHNlCiAgICAgICAgaGVhZGxlc3NTZXJ2aWNlOgogICAgICAgICAgYW5ub3RhdGlvbnM6IHt9CiAgICAgICAgc2VydmljZToKICAgICAgICAgIGFubm90YXRpb25zOiB7fQogICAgICAgICAgZW5hYmxlZDogdHJ1ZQogICAgICAgIHN0YXRlZnVsU2V0OgogICAgICAgICAgYW5ub3RhdGlvbnM6IHt9CiAgICAgICAgICBlbmFibGVTZXJ2aWNlTGlua3M6IHRydWUKICAgICAgICAgIGVuYWJsZWQ6IHRydWUKICAgICAgICAgIGVudjogW10KICAgICAgICAgIGV4dHJhQXJnczogW10KICAgICAgICAgIGhpZ2hBdmFpbGFiaWxpdHk6CiAgICAgICAgICAgIHJlcGxpY2FzOiAxCiAgICAgICAgICBpbWFnZToKICAgICAgICAgICAgcmVnaXN0cnk6IHJlZ2lzdHJ5Lms4cy5pbwogICAgICAgICAgICByZXBvc2l0b3J5OiBldGNkCiAgICAgICAgICAgIHRhZzogMy42LjQtMAogICAgICAgICAgaW1hZ2VQdWxsUG9saWN5OiAiIgogICAgICAgICAgbGFiZWxzOiB7fQogICAgICAgICAgcGVyc2lzdGVuY2U6CiAgICAgICAgICAgIGFkZFZvbHVtZU1vdW50czogW10KICAgICAgICAgICAgYWRkVm9sdW1lczogW10KICAgICAgICAgICAgdm9sdW1lQ2xhaW06CiAgICAgICAgICAgICAgYWNjZXNzTW9kZXM6CiAgICAgICAgICAgICAgLSBSZWFkV3JpdGVPbmNlCiAgICAgICAgICAgICAgZW5hYmxlZDogdHJ1ZQogICAgICAgICAgICAgIHJldGVudGlvblBvbGljeTogUmV0YWluCiAgICAgICAgICAgICAgc2l6ZTogNUdpCiAgICAgICAgICAgICAgc3RvcmFnZUNsYXNzOiAiIgogICAgICAgICAgICB2b2x1bWVDbGFpbVRlbXBsYXRlczogW10KICAgICAgICAgIHBvZHM6CiAgICAgICAgICAgIGFubm90YXRpb25zOiB7fQogICAgICAgICAgICBsYWJlbHM6IHt9CiAgICAgICAgICByZXNvdXJjZXM6CiAgICAgICAgICAgIHJlcXVlc3RzOgogICAgICAgICAgICAgIGNwdTogMjBtCiAgICAgICAgICAgICAgbWVtb3J5OiAxNTBNaQogICAgICAgICAgc2NoZWR1bGluZzoKICAgICAgICAgICAgYWZmaW5pdHk6IHt9CiAgICAgICAgICAgIG5vZGVTZWxlY3Rvcjoge30KICAgICAgICAgICAgcG9kTWFuYWdlbWVudFBvbGljeTogUGFyYWxsZWwKICAgICAgICAgICAgcHJpb3JpdHlDbGFzc05hbWU6ICIiCiAgICAgICAgICAgIHRvbGVyYXRpb25zOiBbXQogICAgICAgICAgICB0b3BvbG9neVNwcmVhZENvbnN0cmFpbnRzOiBbXQogICAgICAgICAgc2VjdXJpdHk6CiAgICAgICAgICAgIGNvbnRhaW5lclNlY3VyaXR5Q29udGV4dDoge30KICAgICAgICAgICAgcG9kU2VjdXJpdHlDb250ZXh0OiB7fQogICAgICBlbWJlZGRlZDoKICAgICAgICBlbmFibGVkOiBmYWxzZQogICAgICAgIGV4dHJhQXJnczogW10KICAgICAgICBtaWdyYXRlRnJvbURlcGxveWVkRXRjZDogZmFsc2UKICAgICAgZXh0ZXJuYWw6CiAgICAgICAgZW5hYmxlZDogZmFsc2UKICAgICAgICBlbmRwb2ludDogIiIKICAgICAgICB0bHM6CiAgICAgICAgICBjYUZpbGU6ICIiCiAgICAgICAgICBjZXJ0RmlsZTogIiIKICAgICAgICAgIGtleUZpbGU6ICIiCiAgY29yZWRuczoKICAgIGRlcGxveW1lbnQ6CiAgICAgIGFmZmluaXR5OiB7fQogICAgICBhbm5vdGF0aW9uczoge30KICAgICAgaW1hZ2U6ICIiCiAgICAgIGxhYmVsczoge30KICAgICAgbm9kZVNlbGVjdG9yOiB7fQogICAgICBwb2RzOgogICAgICAgIGFubm90YXRpb25zOiB7fQogICAgICAgIGxhYmVsczoge30KICAgICAgcmVwbGljYXM6IDEKICAgICAgcmVzb3VyY2VzOgogICAgICAgIGxpbWl0czoKICAgICAgICAgIGNwdTogMTAwMG0KICAgICAgICAgIG1lbW9yeTogMTcwTWkKICAgICAgICByZXF1ZXN0czoKICAgICAgICAgIGNwdTogMjBtCiAgICAgICAgICBtZW1vcnk6IDY0TWkKICAgICAgdG9sZXJhdGlvbnM6IFtdCiAgICAgIHRvcG9sb2d5U3ByZWFkQ29uc3RyYWludHM6CiAgICAgIC0gbGFiZWxTZWxlY3RvcjoKICAgICAgICAgIG1hdGNoTGFiZWxzOgogICAgICAgICAgICBrOHMtYXBwOiB2Y2x1c3Rlci1rdWJlLWRucwogICAgICAgIG1heFNrZXc6IDEKICAgICAgICB0b3BvbG9neUtleToga3ViZXJuZXRlcy5pby9ob3N0bmFtZQogICAgICAgIHdoZW5VbnNhdGlzZmlhYmxlOiBEb05vdFNjaGVkdWxlCiAgICBlbWJlZGRlZDogZmFsc2UKICAgIGVuYWJsZWQ6IHRydWUKICAgIG92ZXJ3cml0ZUNvbmZpZzogIiIKICAgIG92ZXJ3cml0ZU1hbmlmZXN0czogIiIKICAgIHByaW9yaXR5Q2xhc3NOYW1lOiAiIgogICAgc2VjdXJpdHk6CiAgICAgIGNvbnRhaW5lclNlY3VyaXR5Q29udGV4dDoge30KICAgICAgcG9kU2VjdXJpdHlDb250ZXh0OiB7fQogICAgc2VydmljZToKICAgICAgYW5ub3RhdGlvbnM6IHt9CiAgICAgIGxhYmVsczoge30KICAgICAgc3BlYzoKICAgICAgICB0eXBlOiBDbHVzdGVySVAKICBkaXN0cm86CiAgICBrM3M6CiAgICAgIGNvbW1hbmQ6IFtdCiAgICAgIGVuYWJsZWQ6IGZhbHNlCiAgICAgIGV4dHJhQXJnczogW10KICAgICAgaW1hZ2U6CiAgICAgICAgcmVnaXN0cnk6ICIiCiAgICAgICAgcmVwb3NpdG9yeTogcmFuY2hlci9rM3MKICAgICAgICB0YWc6IHYxLjM0LjEtazNzMQogICAgICBpbWFnZVB1bGxQb2xpY3k6ICIiCiAgICAgIHJlc291cmNlczoKICAgICAgICBsaW1pdHM6CiAgICAgICAgICBjcHU6IDEwMG0KICAgICAgICAgIG1lbW9yeTogMjU2TWkKICAgICAgICByZXF1ZXN0czoKICAgICAgICAgIGNwdTogNDBtCiAgICAgICAgICBtZW1vcnk6IDY0TWkKICAgICAgc2VjdXJpdHlDb250ZXh0OiB7fQogICAgazhzOgogICAgICBhcGlTZXJ2ZXI6CiAgICAgICAgY29tbWFuZDogW10KICAgICAgICBlbmFibGVkOiB0cnVlCiAgICAgICAgZXh0cmFBcmdzOgogICAgICAgIC0gLS1mZWF0dXJlLWdhdGVzPVdhdGNoTGlzdD10cnVlLFdhdGNoTGlzdENsaWVudD10cnVlLFZvbHVtZUF0dHJpYnV0ZXNDbGFzcz10cnVlLE11dGF0aW5nQWRtaXNzaW9uUG9saWN5PXRydWUKICAgICAgICAtIC0td2F0Y2gtY2FjaGU9ZmFsc2UKICAgICAgICAtIC0tZXRjZC1zZXJ2ZXJzPWh0dHA6Ly9oYXJpa3ViZS1taWRkbGV3YXJlLXN2Yy5oYXJpa3ViZToyMzc5CiAgICAgICAgLSAtLXJ1bnRpbWUtY29uZmlnPWFkbWlzc2lvbnJlZ2lzdHJhdGlvbi5rOHMuaW8vdjFiZXRhMT10cnVlCiAgICAgICAgLSAtLW1heC1yZXF1ZXN0cy1pbmZsaWdodD05MDAKICAgICAgICAtIC0tbWF4LW11dGF0aW5nLXJlcXVlc3RzLWluZmxpZ2h0PTMwMAogICAgICBjb250cm9sbGVyTWFuYWdlcjoKICAgICAgICBjb21tYW5kOiBbXQogICAgICAgIGVuYWJsZWQ6IHRydWUKICAgICAgICBleHRyYUFyZ3M6IFtdCiAgICAgIGVuYWJsZWQ6IHRydWUKICAgICAgZW52OiBbXQogICAgICBpbWFnZToKICAgICAgICByZWdpc3RyeTogcXVheS5pbwogICAgICAgIHJlcG9zaXRvcnk6IGhhcmlrdWJlL2t1YmVybmV0ZXMKICAgICAgICB0YWc6IHYxLjM1LjAKICAgICAgaW1hZ2VQdWxsUG9saWN5OiBJZk5vdFByZXNlbnQKICAgICAgcmVzb3VyY2VzOgogICAgICAgIGxpbWl0czoKICAgICAgICAgIGNwdTogMTAwbQogICAgICAgICAgbWVtb3J5OiAyNTZNaQogICAgICAgIHJlcXVlc3RzOgogICAgICAgICAgY3B1OiA0MG0KICAgICAgICAgIG1lbW9yeTogNjRNaQogICAgICBzY2hlZHVsZXI6CiAgICAgICAgY29tbWFuZDogW10KICAgICAgICBlbmFibGVkOiB0cnVlCiAgICAgICAgZXh0cmFBcmdzOiBbXQogICAgICBzZWN1cml0eUNvbnRleHQ6IHt9CiAgICAgIHZlcnNpb246ICIiCiAgaW5ncmVzczoKICAgIGFubm90YXRpb25zOgogICAgICBuZ2lueC5pbmdyZXNzLmt1YmVybmV0ZXMuaW8vYmFja2VuZC1wcm90b2NvbDogSFRUUFMKICAgICAgbmdpbnguaW5ncmVzcy5rdWJlcm5ldGVzLmlvL3NzbC1wYXNzdGhyb3VnaDogInRydWUiCiAgICAgIG5naW54LmluZ3Jlc3Mua3ViZXJuZXRlcy5pby9zc2wtcmVkaXJlY3Q6ICJ0cnVlIgogICAgZW5hYmxlZDogZmFsc2UKICAgIGhvc3Q6IG15LWhvc3QuY29tCiAgICBsYWJlbHM6IHt9CiAgICBwYXRoVHlwZTogSW1wbGVtZW50YXRpb25TcGVjaWZpYwogICAgc3BlYzoKICAgICAgdGxzOiBbXQogIHByb3h5OgogICAgYmluZEFkZHJlc3M6IDAuMC4wLjAKICAgIGV4dHJhU0FOczogW10KICAgIHBvcnQ6IDg0NDMKICBzZXJ2aWNlOgogICAgYW5ub3RhdGlvbnM6IHt9CiAgICBlbmFibGVkOiB0cnVlCiAgICBodHRwc05vZGVQb3J0OiAwCiAgICBrdWJlbGV0Tm9kZVBvcnQ6IDAKICAgIGxhYmVsczoge30KICAgIHNwZWM6CiAgICAgIHR5cGU6IENsdXN0ZXJJUAogIHNlcnZpY2VNb25pdG9yOgogICAgYW5ub3RhdGlvbnM6IHt9CiAgICBlbmFibGVkOiBmYWxzZQogICAgbGFiZWxzOiB7fQogIHN0YW5kYWxvbmU6CiAgICBkYXRhRGlyOiAvdmFyL2xpYi92Y2x1c3RlcgogICAgam9pbk5vZGU6CiAgICAgIGNvbnRhaW5lcmQ6CiAgICAgICAgZW5hYmxlZDogdHJ1ZQogICAgICBlbmFibGVkOiB0cnVlCiAgc3RhdGVmdWxTZXQ6CiAgICBhbm5vdGF0aW9uczoge30KICAgIGFyZ3M6IFtdCiAgICBjb21tYW5kOiBbXQogICAgZW5hYmxlU2VydmljZUxpbmtzOiB0cnVlCiAgICBlbnY6IFtdCiAgICBoaWdoQXZhaWxhYmlsaXR5OgogICAgICBsZWFzZUR1cmF0aW9uOiA2MAogICAgICByZW5ld0RlYWRsaW5lOiA0MAogICAgICByZXBsaWNhczogMQogICAgICByZXRyeVBlcmlvZDogMTUKICAgIGltYWdlOgogICAgICByZWdpc3RyeTogZ2hjci5pbwogICAgICByZXBvc2l0b3J5OiBsb2Z0LXNoL3ZjbHVzdGVyLXBybwogICAgICB0YWc6ICIiCiAgICBpbWFnZVB1bGxQb2xpY3k6ICIiCiAgICBpbml0Q29udGFpbmVyczogW10KICAgIGxhYmVsczoge30KICAgIHBlcnNpc3RlbmNlOgogICAgICBhZGRWb2x1bWVNb3VudHM6IFtdCiAgICAgIGFkZFZvbHVtZXM6IFtdCiAgICAgIGJpbmFyaWVzVm9sdW1lOgogICAgICAtIGVtcHR5RGlyOiB7fQogICAgICAgIG5hbWU6IGJpbmFyaWVzCiAgICAgIGRhdGFWb2x1bWU6IFtdCiAgICAgIHZvbHVtZUNsYWltOgogICAgICAgIGFjY2Vzc01vZGVzOgogICAgICAgIC0gUmVhZFdyaXRlT25jZQogICAgICAgIGVuYWJsZWQ6IGF1dG8KICAgICAgICByZXRlbnRpb25Qb2xpY3k6IFJldGFpbgogICAgICAgIHNpemU6IDVHaQogICAgICAgIHN0b3JhZ2VDbGFzczogIiIKICAgICAgdm9sdW1lQ2xhaW1UZW1wbGF0ZXM6IFtdCiAgICBwb2RzOgogICAgICBhbm5vdGF0aW9uczoge30KICAgICAgbGFiZWxzOiB7fQogICAgcHJvYmVzOgogICAgICBsaXZlbmVzc1Byb2JlOgogICAgICAgIGVuYWJsZWQ6IHRydWUKICAgICAgICBmYWlsdXJlVGhyZXNob2xkOiA2MAogICAgICAgIGluaXRpYWxEZWxheVNlY29uZHM6IDYwCiAgICAgICAgcGVyaW9kU2Vjb25kczogMgogICAgICAgIHRpbWVvdXRTZWNvbmRzOiAzCiAgICAgIHJlYWRpbmVzc1Byb2JlOgogICAgICAgIGVuYWJsZWQ6IHRydWUKICAgICAgICBmYWlsdXJlVGhyZXNob2xkOiA2MAogICAgICAgIHBlcmlvZFNlY29uZHM6IDIKICAgICAgICB0aW1lb3V0U2Vjb25kczogMwogICAgICBzdGFydHVwUHJvYmU6CiAgICAgICAgZW5hYmxlZDogdHJ1ZQogICAgICAgIGZhaWx1cmVUaHJlc2hvbGQ6IDMwMAogICAgICAgIHBlcmlvZFNlY29uZHM6IDYKICAgICAgICB0aW1lb3V0U2Vjb25kczogMwogICAgcmVzb3VyY2VzOgogICAgICBsaW1pdHM6CiAgICAgICAgZXBoZW1lcmFsLXN0b3JhZ2U6IDEwR2kKICAgICAgICBtZW1vcnk6IDRHaQogICAgICByZXF1ZXN0czoKICAgICAgICBjcHU6IDIwMG0KICAgICAgICBlcGhlbWVyYWwtc3RvcmFnZTogMUdpCiAgICAgICAgbWVtb3J5OiAyNTZNaQogICAgc2NoZWR1bGluZzoKICAgICAgYWZmaW5pdHk6IHt9CiAgICAgIG5vZGVTZWxlY3Rvcjoge30KICAgICAgcG9kTWFuYWdlbWVudFBvbGljeTogUGFyYWxsZWwKICAgICAgcHJpb3JpdHlDbGFzc05hbWU6ICIiCiAgICAgIHRvbGVyYXRpb25zOiBbXQogICAgICB0b3BvbG9neVNwcmVhZENvbnN0cmFpbnRzOiBbXQogICAgc2VjdXJpdHk6CiAgICAgIGNvbnRhaW5lclNlY3VyaXR5Q29udGV4dDoKICAgICAgICBhbGxvd1ByaXZpbGVnZUVzY2FsYXRpb246IGZhbHNlCiAgICAgICAgcnVuQXNHcm91cDogMAogICAgICAgIHJ1bkFzVXNlcjogMAogICAgICBwb2RTZWN1cml0eUNvbnRleHQ6IHt9CiAgICBzaWRlY2FyQ29udGFpbmVyczogW10KICAgIHdvcmtpbmdEaXI6ICIiCmRlcGxveToKICBjbmk6CiAgICBmbGFubmVsOgogICAgICBlbmFibGVkOiB0cnVlCiAgaW5ncmVzc05naW54OgogICAgZGVmYXVsdEluZ3Jlc3NDbGFzczogdHJ1ZQogICAgZW5hYmxlZDogZmFsc2UKICBrdWJlUHJveHk6CiAgICBjb25maWc6IHt9CiAgICBlbmFibGVkOiB0cnVlCiAgICBleHRyYUFyZ3M6IFtdCiAgICBleHRyYUVudjogW10KICAgIGltYWdlOiAiIgogICAgaW1hZ2VQdWxsUG9saWN5OiAiIgogICAgbm9kZVNlbGVjdG9yOiB7fQogICAgdG9sZXJhdGlvbnM6IFtdCiAgbG9jYWxQYXRoUHJvdmlzaW9uZXI6CiAgICBlbmFibGVkOiB0cnVlCiAgbWV0YWxsYjoKICAgIGVuYWJsZWQ6IGZhbHNlCiAgICBpcEFkZHJlc3NQb29sOgogICAgICBhZGRyZXNzZXM6IFtdCiAgICAgIGwyQWR2ZXJ0aXNlbWVudDogdHJ1ZQogIG1ldHJpY3NTZXJ2ZXI6CiAgICBlbmFibGVkOiBmYWxzZQogIHZvbHVtZVNuYXBzaG90Q29udHJvbGxlcjoKICAgIGVuYWJsZWQ6IGZhbHNlCmV4cGVyaW1lbnRhbDoKICBkZXBsb3k6CiAgICBob3N0OgogICAgICBtYW5pZmVzdHM6ICIiCiAgICAgIG1hbmlmZXN0c1RlbXBsYXRlOiAiIgogICAgdmNsdXN0ZXI6CiAgICAgIGhlbG06IFtdCiAgICAgIG1hbmlmZXN0czogIiIKICAgICAgbWFuaWZlc3RzVGVtcGxhdGU6ICIiCiAgZG9ja2VyOgogICAgbG9hZEJhbGFuY2VyOgogICAgICBlbmFibGVkOiB0cnVlCiAgICAgIGZvcndhcmRQb3J0czogdHJ1ZQogICAgcmVnaXN0cnlQcm94eToKICAgICAgZW5hYmxlZDogdHJ1ZQogIHByb3h5OgogICAgY3VzdG9tUmVzb3VyY2VzOiB7fQogIHN5bmNTZXR0aW5nczoKICAgIHNldE93bmVyOiB0cnVlCmV4cG9ydEt1YmVDb25maWc6CiAgYWRkaXRpb25hbFNlY3JldHM6IFtdCiAgY29udGV4dDogIiIKICBpbnNlY3VyZTogZmFsc2UKICBzZWNyZXQ6CiAgICBuYW1lOiAiIgogICAgbmFtZXNwYWNlOiAiIgogIHNlcnZlcjogIiIKICBzZXJ2aWNlQWNjb3VudDoKICAgIGNsdXN0ZXJSb2xlOiAiIgogICAgbmFtZTogIiIKICAgIG5hbWVzcGFjZTogIiIKZXh0ZXJuYWw6IHt9CmludGVncmF0aW9uczoKICBjZXJ0TWFuYWdlcjoKICAgIGVuYWJsZWQ6IGZhbHNlCiAgICBzeW5jOgogICAgICBmcm9tSG9zdDoKICAgICAgICBjbHVzdGVySXNzdWVyczoKICAgICAgICAgIGVuYWJsZWQ6IHRydWUKICAgICAgICAgIHNlbGVjdG9yOgogICAgICAgICAgICBsYWJlbHM6IHt9CiAgICAgIHRvSG9zdDoKICAgICAgICBjZXJ0aWZpY2F0ZXM6CiAgICAgICAgICBlbmFibGVkOiB0cnVlCiAgICAgICAgaXNzdWVyczoKICAgICAgICAgIGVuYWJsZWQ6IHRydWUKICBleHRlcm5hbFNlY3JldHM6CiAgICBlbmFibGVkOiBmYWxzZQogICAgc3luYzoKICAgICAgZnJvbUhvc3Q6CiAgICAgICAgY2x1c3RlclN0b3JlczoKICAgICAgICAgIGVuYWJsZWQ6IGZhbHNlCiAgICAgICAgICBzZWxlY3RvcjoKICAgICAgICAgICAgbWF0Y2hMYWJlbHM6IHt9CiAgICAgIHRvSG9zdDoKICAgICAgICBleHRlcm5hbFNlY3JldHM6CiAgICAgICAgICBzZWxlY3RvcjoKICAgICAgICAgICAgbWF0Y2hMYWJlbHM6IHt9CiAgICAgICAgc3RvcmVzOgogICAgICAgICAgZW5hYmxlZDogZmFsc2UKICAgICAgICAgIHNlbGVjdG9yOgogICAgICAgICAgICBtYXRjaExhYmVsczoge30KICAgIHdlYmhvb2s6CiAgICAgIGVuYWJsZWQ6IGZhbHNlCiAgaXN0aW86CiAgICBlbmFibGVkOiBmYWxzZQogICAgc3luYzoKICAgICAgdG9Ib3N0OgogICAgICAgIGRlc3RpbmF0aW9uUnVsZXM6CiAgICAgICAgICBlbmFibGVkOiB0cnVlCiAgICAgICAgZ2F0ZXdheXM6CiAgICAgICAgICBlbmFibGVkOiB0cnVlCiAgICAgICAgdmlydHVhbFNlcnZpY2VzOgogICAgICAgICAgZW5hYmxlZDogdHJ1ZQogIGt1YmVWaXJ0OgogICAgZW5hYmxlZDogZmFsc2UKICAgIHN5bmM6CiAgICAgIGRhdGFWb2x1bWVzOgogICAgICAgIGVuYWJsZWQ6IGZhbHNlCiAgICAgIHZpcnR1YWxNYWNoaW5lQ2xvbmVzOgogICAgICAgIGVuYWJsZWQ6IHRydWUKICAgICAgdmlydHVhbE1hY2hpbmVJbnN0YW5jZU1pZ3JhdGlvbnM6CiAgICAgICAgZW5hYmxlZDogdHJ1ZQogICAgICB2aXJ0dWFsTWFjaGluZUluc3RhbmNlczoKICAgICAgICBlbmFibGVkOiB0cnVlCiAgICAgIHZpcnR1YWxNYWNoaW5lUG9vbHM6CiAgICAgICAgZW5hYmxlZDogdHJ1ZQogICAgICB2aXJ0dWFsTWFjaGluZXM6CiAgICAgICAgZW5hYmxlZDogdHJ1ZQogICAgd2ViaG9vazoKICAgICAgZW5hYmxlZDogdHJ1ZQogIG1ldHJpY3NTZXJ2ZXI6CiAgICBlbmFibGVkOiBmYWxzZQogICAgbm9kZXM6IHRydWUKICAgIHBvZHM6IHRydWUKbG9nZ2luZzoKICBlbmNvZGluZzogY29uc29sZQpuZXR3b3JraW5nOgogIGFkdmFuY2VkOgogICAgY2x1c3RlckRvbWFpbjogY2x1c3Rlci5sb2NhbAogICAgZmFsbGJhY2tIb3N0Q2x1c3RlcjogZmFsc2UKICAgIHByb3h5S3ViZWxldHM6CiAgICAgIGJ5SG9zdG5hbWU6IHRydWUKICAgICAgYnlJUDogdHJ1ZQogIHBvZENJRFI6IDEwLjI0NC4wLjAvMTYKICByZXBsaWNhdGVTZXJ2aWNlczoKICAgIGZyb21Ib3N0OiBbXQogICAgdG9Ib3N0OiBbXQogIHJlc29sdmVETlM6IFtdCnBsdWdpbnM6IHt9CnBvbGljaWVzOgogIGNlbnRyYWxBZG1pc3Npb246CiAgICBtdXRhdGluZ1dlYmhvb2tzOiBbXQogICAgdmFsaWRhdGluZ1dlYmhvb2tzOiBbXQogIGxpbWl0UmFuZ2U6CiAgICBhbm5vdGF0aW9uczoge30KICAgIGRlZmF1bHQ6CiAgICAgIGNwdTogIjEiCiAgICAgIGVwaGVtZXJhbC1zdG9yYWdlOiA4R2kKICAgICAgbWVtb3J5OiA1MTJNaQogICAgZGVmYXVsdFJlcXVlc3Q6CiAgICAgIGNwdTogMTAwbQogICAgICBlcGhlbWVyYWwtc3RvcmFnZTogM0dpCiAgICAgIG1lbW9yeTogMTI4TWkKICAgIGVuYWJsZWQ6IGF1dG8KICAgIGxhYmVsczoge30KICAgIG1heDoge30KICAgIG1pbjoge30KICBuZXR3b3JrUG9saWN5OgogICAgYW5ub3RhdGlvbnM6IHt9CiAgICBjb250cm9sUGxhbmU6CiAgICAgIGVncmVzczogW10KICAgICAgaW5ncmVzczogW10KICAgIGVuYWJsZWQ6IGZhbHNlCiAgICBmYWxsYmFja0RuczogOC44LjguOAogICAgbGFiZWxzOiB7fQogICAgd29ya2xvYWQ6CiAgICAgIGVncmVzczogW10KICAgICAgaW5ncmVzczogW10KICAgICAgcHVibGljRWdyZXNzOgogICAgICAgIGNpZHI6IDAuMC4wLjAvMAogICAgICAgIGVuYWJsZWQ6IHRydWUKICAgICAgICBleGNlcHQ6CiAgICAgICAgLSAxMDAuNjQuMC4wLzEwCiAgICAgICAgLSAxMjcuMC4wLjAvOAogICAgICAgIC0gMTAuMC4wLjAvOAogICAgICAgIC0gMTcyLjE2LjAuMC8xMgogICAgICAgIC0gMTkyLjE2OC4wLjAvMTYKICByZXNvdXJjZVF1b3RhOgogICAgYW5ub3RhdGlvbnM6IHt9CiAgICBlbmFibGVkOiBhdXRvCiAgICBsYWJlbHM6IHt9CiAgICBxdW90YToKICAgICAgY291bnQvY29uZmlnbWFwczogMTAwCiAgICAgIGNvdW50L2VuZHBvaW50czogNDAKICAgICAgY291bnQvcGVyc2lzdGVudHZvbHVtZWNsYWltczogMjAKICAgICAgY291bnQvcG9kczogMjAKICAgICAgY291bnQvc2VjcmV0czogMTAwCiAgICAgIGNvdW50L3NlcnZpY2VzOiAyMAogICAgICBsaW1pdHMuY3B1OiAyMAogICAgICBsaW1pdHMuZXBoZW1lcmFsLXN0b3JhZ2U6IDE2MEdpCiAgICAgIGxpbWl0cy5tZW1vcnk6IDQwR2kKICAgICAgcmVxdWVzdHMuY3B1OiAxMAogICAgICByZXF1ZXN0cy5lcGhlbWVyYWwtc3RvcmFnZTogNjBHaQogICAgICByZXF1ZXN0cy5tZW1vcnk6IDIwR2kKICAgICAgcmVxdWVzdHMuc3RvcmFnZTogMTAwR2kKICAgICAgc2VydmljZXMubG9hZGJhbGFuY2VyczogMQogICAgICBzZXJ2aWNlcy5ub2RlcG9ydHM6IDAKICAgIHNjb3BlU2VsZWN0b3I6CiAgICAgIG1hdGNoRXhwcmVzc2lvbnM6IFtdCiAgICBzY29wZXM6IFtdCnByaXZhdGVOb2RlczoKICBhdXRvTm9kZXM6IFtdCiAgYXV0b1VwZ3JhZGU6CiAgICBjb25jdXJyZW5jeTogMQogICAgZW5hYmxlZDogdHJ1ZQogIGVuYWJsZWQ6IGZhbHNlCiAgam9pbk5vZGU6CiAgICBjb250YWluZXJkOgogICAgICBlbmFibGVkOiB0cnVlCiAga3ViZWxldDoKICAgIGNvbmZpZzoge30KICB2cG46CiAgICBlbmFibGVkOiBmYWxzZQogICAgbm9kZVRvTm9kZToKICAgICAgZW5hYmxlZDogZmFsc2UKcmJhYzoKICBjbHVzdGVyUm9sZToKICAgIGVuYWJsZWQ6IGF1dG8KICAgIGV4dHJhUnVsZXM6IFtdCiAgICBvdmVyd3JpdGVSdWxlczogW10KICBlbmFibGVWb2x1bWVTbmFwc2hvdFJ1bGVzOgogICAgZW5hYmxlZDogYXV0bwogIHJvbGU6CiAgICBlbmFibGVkOiB0cnVlCiAgICBleHRyYVJ1bGVzOiBbXQogICAgb3ZlcndyaXRlUnVsZXM6IFtdCnN5bmM6CiAgZnJvbUhvc3Q6CiAgICBjb25maWdNYXBzOgogICAgICBlbmFibGVkOiBmYWxzZQogICAgICBtYXBwaW5nczoKICAgICAgICBieU5hbWU6IHt9CiAgICBjc2lEcml2ZXJzOgogICAgICBlbmFibGVkOiBhdXRvCiAgICBjc2lOb2RlczoKICAgICAgZW5hYmxlZDogYXV0bwogICAgY3NpU3RvcmFnZUNhcGFjaXRpZXM6CiAgICAgIGVuYWJsZWQ6IGF1dG8KICAgIGV2ZW50czoKICAgICAgZW5hYmxlZDogdHJ1ZQogICAgaW5ncmVzc0NsYXNzZXM6CiAgICAgIGVuYWJsZWQ6IGZhbHNlCiAgICBub2RlczoKICAgICAgY2xlYXJJbWFnZVN0YXR1czogZmFsc2UKICAgICAgZW5hYmxlZDogdHJ1ZQogICAgICBzZWxlY3RvcjoKICAgICAgICBhbGw6IGZhbHNlCiAgICAgICAgbGFiZWxzOiB7fQogICAgICBzeW5jQmFja0NoYW5nZXM6IGZhbHNlCiAgICBwcmlvcml0eUNsYXNzZXM6CiAgICAgIGVuYWJsZWQ6IGZhbHNlCiAgICBydW50aW1lQ2xhc3NlczoKICAgICAgZW5hYmxlZDogZmFsc2UKICAgIHNlY3JldHM6CiAgICAgIGVuYWJsZWQ6IHRydWUKICAgICAgbWFwcGluZ3M6CiAgICAgICAgYnlOYW1lOgogICAgICAgICAgaGFyaWt1YmUvdG9wb2xvZ3ktY29uZmlnOiBoYXJpa3ViZS90b3BvbG9neS1jb25maWcKICAgIHN0b3JhZ2VDbGFzc2VzOgogICAgICBlbmFibGVkOiBhdXRvCiAgICB2b2x1bWVTbmFwc2hvdENsYXNzZXM6CiAgICAgIGVuYWJsZWQ6IGZhbHNlCiAgdG9Ib3N0OgogICAgY29uZmlnTWFwczoKICAgICAgYWxsOiBmYWxzZQogICAgICBlbmFibGVkOiB0cnVlCiAgICBlbmRwb2ludFNsaWNlczoKICAgICAgZW5hYmxlZDogdHJ1ZQogICAgZW5kcG9pbnRzOgogICAgICBlbmFibGVkOiB0cnVlCiAgICBpbmdyZXNzZXM6CiAgICAgIGVuYWJsZWQ6IHRydWUKICAgIG5hbWVzcGFjZXM6CiAgICAgIGVuYWJsZWQ6IGZhbHNlCiAgICAgIG1hcHBpbmdzT25seTogZmFsc2UKICAgIG5ldHdvcmtQb2xpY2llczoKICAgICAgZW5hYmxlZDogdHJ1ZQogICAgcGVyc2lzdGVudFZvbHVtZUNsYWltczoKICAgICAgZW5hYmxlZDogdHJ1ZQogICAgcGVyc2lzdGVudFZvbHVtZXM6CiAgICAgIGVuYWJsZWQ6IHRydWUKICAgIHBvZERpc3J1cHRpb25CdWRnZXRzOgogICAgICBlbmFibGVkOiB0cnVlCiAgICBwb2RzOgogICAgICBlbmFibGVkOiB0cnVlCiAgICAgIGVuZm9yY2VUb2xlcmF0aW9uczogW10KICAgICAgaHlicmlkU2NoZWR1bGluZzoKICAgICAgICBlbmFibGVkOiBmYWxzZQogICAgICAgIGhvc3RTY2hlZHVsZXJzOiBbXQogICAgICBwcmlvcml0eUNsYXNzTmFtZTogIiIKICAgICAgcmV3cml0ZUhvc3RzOgogICAgICAgIGVuYWJsZWQ6IHRydWUKICAgICAgICBpbml0Q29udGFpbmVyOgogICAgICAgICAgaW1hZ2U6CiAgICAgICAgICAgIHJlZ2lzdHJ5OiBtaXJyb3IuZ2NyLmlvCiAgICAgICAgICAgIHJlcG9zaXRvcnk6IGxpYnJhcnkvYWxwaW5lCiAgICAgICAgICAgIHRhZzogIjMuMjAiCiAgICAgICAgICByZXNvdXJjZXM6CiAgICAgICAgICAgIGxpbWl0czoKICAgICAgICAgICAgICBjcHU6IDMwbQogICAgICAgICAgICAgIG1lbW9yeTogNjRNaQogICAgICAgICAgICByZXF1ZXN0czoKICAgICAgICAgICAgICBjcHU6IDMwbQogICAgICAgICAgICAgIG1lbW9yeTogNjRNaQogICAgICBydW50aW1lQ2xhc3NOYW1lOiAiIgogICAgICB0cmFuc2xhdGVJbWFnZToge30KICAgICAgdXNlU2VjcmV0c0ZvclNBVG9rZW5zOiBmYWxzZQogICAgcHJpb3JpdHlDbGFzc2VzOgogICAgICBlbmFibGVkOiB0cnVlCiAgICBzZWNyZXRzOgogICAgICBhbGw6IGZhbHNlCiAgICAgIGVuYWJsZWQ6IHRydWUKICAgIHNlcnZpY2VBY2NvdW50czoKICAgICAgZW5hYmxlZDogdHJ1ZQogICAgc2VydmljZXM6CiAgICAgIGVuYWJsZWQ6IHRydWUKICAgIHN0b3JhZ2VDbGFzc2VzOgogICAgICBlbmFibGVkOiB0cnVlCiAgICB2b2x1bWVTbmFwc2hvdENvbnRlbnRzOgogICAgICBlbmFibGVkOiBmYWxzZQogICAgdm9sdW1lU25hcHNob3RzOgogICAgICBlbmFibGVkOiBmYWxzZQp0ZWxlbWV0cnk6CiAgZW5hYmxlZDogdHJ1ZQ=="
---
# Source: vcluster/templates/clusterrole.yaml
kind: ClusterRole
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: vc-harikube-v-harikube
  labels:
    app: vcluster
    chart: "vcluster-0.31.0"
    release: "harikube"
    heritage: "Helm"
rules:
  - apiGroups: [""]
    resources: ["pods", "nodes", "nodes/status", "nodes/metrics", "nodes/stats", "nodes/proxy"]
    verbs: ["get", "watch", "list"]
  - apiGroups: ["storage.k8s.io"]
    resources: ["storageclasses", "csinodes", "csidrivers", "csistoragecapacities"]
    verbs: ["get", "watch", "list"]
  - apiGroups: [ "" ]
    resources: [ "persistentvolumes" ]
    verbs: [ "get", "list" ]
  - apiGroups: [""]
    resources: ["persistentvolumes"]
    verbs: ["create", "delete", "patch", "update", "watch"]
  - apiGroups: ["storage.k8s.io"]
    resources: ["storageclasses"]
    verbs: ["create", "delete", "patch", "update", "get", "watch", "list"]
  - apiGroups: ["scheduling.k8s.io"]
    resources: ["priorityclasses"]
    verbs: ["create", "delete", "patch", "update", "get", "list", "watch"]
  - apiGroups: [ "snapshot.storage.k8s.io" ]
    resources: [ "volumesnapshotclasses" ]
    verbs: ["get", "list"]
  - apiGroups: [ "snapshot.storage.k8s.io" ]
    resources: [ "volumesnapshotcontents" ]
    verbs: ["create", "delete", "patch", "update", "get", "list"]
  
  - apiGroups: [""]
    resources: [ "namespaces" ]
    resourceNames: [ "harikube" ]
    verbs: ["get", "list", "watch"]
  - apiGroups: [""]
    resources: [ "secrets" ]
    verbs: ["list", "watch"]
  - apiGroups: [""]
    resources: [ "secrets" ]
    verbs: ["get"]
    resourceNames: [ "topology-config" ]
---
# Source: vcluster/templates/clusterrolebinding.yaml
kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: vc-harikube-v-harikube
  labels:
    app: vcluster
    chart: "vcluster-0.31.0"
    release: "harikube"
    heritage: "Helm"
subjects:
  - kind: ServiceAccount
    name: vc-harikube
    namespace: harikube
roleRef:
  kind: ClusterRole
  name: vc-harikube-v-harikube
  apiGroup: rbac.authorization.k8s.io
---
# Source: vcluster/templates/role.yaml
kind: Role
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: vc-harikube
  namespace: harikube
  labels:
    app: vcluster
    chart: "vcluster-0.31.0"
    release: "harikube"
    heritage: "Helm"
rules:
  - apiGroups: [""]
    resources: ["configmaps", "secrets", "services", "pods", "pods/attach", "pods/portforward", "pods/exec", "persistentvolumeclaims"]
    verbs: ["create", "delete", "patch", "update", "get", "list", "watch"]
  - apiGroups: [""]
    resources: ["pods/status", "pods/ephemeralcontainers"]
    verbs: ["patch", "update"]
  - apiGroups: ["apps"]
    resources: ["statefulsets", "replicasets", "deployments"]
    verbs: ["get", "list", "watch"]
  - apiGroups: [""]
    resources: ["endpoints", "pods/log"]
    verbs: ["get", "list", "watch"]
  - apiGroups: [ "" ]
    resources: ["events"]
    verbs: [ "create", "get", "list", "watch" ]
  - apiGroups: [""]
    resources: ["endpoints"]
    verbs: ["create", "delete", "patch", "update"]
  - apiGroups: ["discovery.k8s.io"]
    resources: [ "endpointslices" ]
    verbs: [ "create", "list", "get", "delete", "patch", "update", "watch" ]
  - apiGroups: ["networking.k8s.io"]
    resources: ["ingresses"]
    verbs: ["create", "delete", "patch", "update", "get", "list", "watch"]
  - apiGroups: ["networking.k8s.io"]
    resources: ["networkpolicies"]
    verbs: ["create", "delete", "patch", "update", "get", "list", "watch"]
  - apiGroups: [ "snapshot.storage.k8s.io" ]
    resources: [ "volumesnapshots" ]
    verbs: ["create", "delete", "patch", "update", "get", "list"]
  - apiGroups: [""]
    resources: ["serviceaccounts"]
    verbs: ["create", "delete", "patch", "update", "get", "list", "watch"]
  - apiGroups: ["policy"]
    resources: ["poddisruptionbudgets"]
    verbs: ["create", "delete", "patch", "update", "get", "list", "watch"]
---
# Source: vcluster/templates/rolebinding.yaml
kind: RoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: vc-harikube
  namespace: harikube
  labels:
    app: vcluster
    chart: "vcluster-0.31.0"
    release: "harikube"
    heritage: "Helm"
subjects:
  - kind: ServiceAccount
    name: vc-harikube
    namespace: harikube
roleRef:
  kind: Role
  name: vc-harikube
  apiGroup: rbac.authorization.k8s.io
---
# Source: vcluster/templates/headless-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: harikube-headless
  namespace: harikube
  labels:
    app: vcluster
    chart: "vcluster-0.31.0"
    release: "harikube"
    heritage: "Helm"
spec:
  publishNotReadyAddresses: true
  ports:
    - name: https
      port: 443
      targetPort: 8443
      protocol: TCP
  clusterIP: None
  selector:
    app: vcluster
    release: "harikube"
---
# Source: vcluster/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: harikube
  namespace: harikube
  labels:
    app: vcluster
    chart: "vcluster-0.31.0"
    release: "harikube"
    heritage: "Helm"
    vcluster.loft.sh/service: "true"
spec:
  type: ClusterIP
  ports:
    - name: https
      port: 443
      targetPort: 8443
      nodePort: 0
      protocol: TCP
    - name: kubelet
      port: 10250
      targetPort: 8443
      nodePort: 0
      protocol: TCP
  selector:
    app: vcluster
    release: harikube
---
# Source: vcluster/templates/statefulset.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: harikube
  namespace: harikube
  labels:
    app: vcluster
    chart: "vcluster-0.31.0"
    release: harikube
    heritage: "Helm"
spec:
  selector:
    matchLabels:
      app: vcluster
      release: "harikube"
  persistentVolumeClaimRetentionPolicy:
    whenDeleted: Retain
  serviceName: harikube-headless
  podManagementPolicy: Parallel
  
  volumeClaimTemplates:
  - metadata:
      name: data
    spec:
      accessModes: [ReadWriteOnce]
      resources:
        requests:
          storage: 5Gi
  replicas: 1
  template:
    metadata:
      annotations:
        vClusterConfigHash: "cd8178472c0f4a1a5dfe8fa6e9ba565a931e77d05952b069eb45e25c4e9d39f3"
      labels:
        app: vcluster
        release: harikube
    spec:
      terminationGracePeriodSeconds: 15
      serviceAccountName: vc-harikube
      volumes:        
        - name: helm-cache
          emptyDir: {}
        - emptyDir: {}
          name: binaries
        - name: tmp
          emptyDir: {}
        - name: certs
          emptyDir: {}
        - name: vcluster-config
          secret:
            secretName: vc-config-harikube
      initContainers:
        
        - name: kubernetes
          image: "quay.io/harikube/kubernetes:v1.35.0"
          volumeMounts:
            - mountPath: /binaries
              name: binaries
          command:
            - cp
          args:
            - -r 
            - /kubernetes/.
            - /binaries/
          imagePullPolicy: IfNotPresent
          securityContext:
            {}
          resources:
            limits:
              cpu: 100m
              memory: 256Mi
            requests:
              cpu: 40m
              memory: 64Mi
      enableServiceLinks: true
      containers:
        - name: syncer
          image: "ghcr.io/loft-sh/vcluster-pro:0.31.0"
          imagePullPolicy: 
          livenessProbe:
            httpGet:
              path: /healthz
              port: 8443
              scheme: HTTPS
            initialDelaySeconds: 60
            periodSeconds: 2
            timeoutSeconds: 3
            failureThreshold: 60
          readinessProbe:
            httpGet:
              path: /readyz
              port: 8443
              scheme: HTTPS
            periodSeconds: 2
            timeoutSeconds: 3
            failureThreshold: 60
          startupProbe:
            httpGet:
              path: /readyz
              port: 8443
              scheme: HTTPS
            periodSeconds: 6
            timeoutSeconds: 3
            failureThreshold: 300
          securityContext:
            allowPrivilegeEscalation: false
            runAsGroup: 0
            runAsUser: 0
          resources:
            limits:
              ephemeral-storage: 10Gi
              memory: 4Gi
            requests:
              cpu: 200m
              ephemeral-storage: 1Gi
              memory: 256Mi
          env:
            - name: VCLUSTER_NAME
              value: "harikube"
            - name: LOFT_LOG_ENCODING
              value: console
            - name: POD_NAME
              valueFrom:
                fieldRef:
                  fieldPath: metadata.name
            - name: POD_IP
              valueFrom:
                fieldRef:
                  fieldPath: status.podIP
            - name: NODE_NAME
              valueFrom:
                fieldRef:
                  fieldPath: spec.nodeName
            - name: NODE_IP
              valueFrom:
                fieldRef:
                  fieldPath: status.hostIP
            
          volumeMounts:            
            - name: data
              mountPath: /data
            - name: binaries
              mountPath: /binaries
            - name: certs
              mountPath: /pki
            - name: helm-cache
              mountPath: /.cache/helm
            - name: vcluster-config
              mountPath: /var/lib/vcluster
            - name: tmp
              mountPath: /tmp
